from flask import Flask, jsonify
from flask_cors import CORS
import pandas as pd
import re
from normalisasi import normalisasi
from stopword import stopword
from stemming import stemming

app = Flask(__name__)

# Enable CORS
CORS(app, origins='*')

# Route Beranda
@app.route('/')
def home():
     return 'Welcome my API'

# Route untuk mendapatkan data dari file CSV
@app.route('/get-data', methods=['GET'])
def get_data():
     try:
          # Memuat data dari file CSV
          df = pd.read_csv('data/guru.csv')
          
          # Mengonversi data ke format JSON
          return df.to_json(orient='records')
     
     except Exception as e:
          return jsonify({'error': str(e)})
     
# Route data yang sudah dibersihkan
@app.route('/clean-data', methods=['GET'])
def clean_data():
     try:
          # Memuat data dari file CSV
          df = pd.read_csv('data/guru.csv')

          # Drop data duplikat dan data kosong
          df = df.drop_duplicates(subset=['full_text'])
          df = df.dropna(subset=['full_text'])
          # Konversi teks menjadi lowercase
          df['full_text'] = df['full_text'].str.lower()

          # Membuat regex untuk menghapus mention, hastag, url, titik, titik dua, koma, dan karakter !, ? dan -
          # df['full_text'] = df['full_text'].apply(lambda x: re.sub(r'@[^\s]+|#|https?://[^\s]+|\.', '', x))
          # df['full_text'] = df['full_text'].apply(lambda x: re.sub(r':', '', x))
          # df['full_text'] = df['full_text'].apply(lambda x: re.sub(r',', '', x))
          # df['full_text'] = df['full_text'].apply(lambda x: re.sub(r'[!?\-]', '', x))

          # Normalisasi, stopword, dan stemming
          # df['full_text'] = df['full_text'].apply(normalisasi)
          # df['full_text'] = df['full_text'].apply(stopword)
          # df['full_text'] = df['full_text'].apply(lambda x: x.split())
          # df['full_text'] = df['full_text'].apply(stemming)

          # Mengonversi data ke format JSON
          return jsonify(df.to_dict(orient='records'))
     
     except Exception as e:
          return jsonify({'error': str(e)})

if __name__ == '__main__':
     app.run(debug=True)